<!DOCTYPE html>
<html lang="en" id="html-root">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible Glass Site — Light-first, Seasonal Themes</title>

  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Poppins:wght@400;600&family=IBM+Plex+Sans:wght@400;600&family=Merriweather:wght@700&family=Nunito:wght@400;700&family=Lato:wght@400;700&display=swap"
    rel="stylesheet">
  <!-- OpenDyslexic (applied only for Dyslexia theme) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/antijingoist/open-dyslexic/fonts/OpenDyslexic.css" />
  <!--font awesome-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    referrerpolicy="no-referrer">

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom stylesheet -->
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>
  <!-- Skip link -->
  <a class="skip-link" href="#main-content">Skip to main content</a>


  <!-- theme-overlay: tinted overlay per theme (animated) -->
  <div class="theme-overlay" aria-hidden="true"></div>
  <div class="overlay" aria-hidden="true"></div>

  <header>
    <div id="site-nav"></div>
  </header>

  <main id="main-content" role="main" class="container py-4">


    <section id="contact" class="container py-5">
      <div class="row align-items-start g-4">

        <!-- LEFT COLUMN -->
        <div class="col-md-6 d-flex flex-column gap-4">

          <!-- VIDEO PANEL -->
          <div class="glass-panel p-3">
            <h2 class="text-center mb-3">Contact Us</h2>
            <div class="video-container">
              <video autoplay muted loop playsinline class="w-100 rounded-4 shadow-sm" aria-hidden="true">
                <source src="../assets/media/bbcentre.mp4" type="video/mp4">
              </video>
            </div>
          </div>

          <!-- CONTACT & SOCIAL PANEL (SAME WIDTH AS VIDEO) -->
          <div class="glass-panel soft-card p-3 text-center">

            <div class="d-flex justify-content-center align-items-center gap-4">

              <a href="mailto:office@bb-northwest.org.uk" aria-label="Email us">
                <i class="fa-solid fa-envelope fa-2x"></i>
              </a>

              <a href="tel:+4401772685000" aria-label="Call us">
                <i class="fa-solid fa-phone fa-2x"></i>
              </a>

              <a href="../pages/location" aria-label="Find our location">
                <i class="fa-solid fa-location-dot fa-2x"></i>
              </a>

              <a href="https://www.facebook.com/yourpage" target="_blank" rel="noopener" aria-label="Facebook">
                <i class="fa-brands fa-facebook fa-2x"></i>
              </a>

              <a href="https://www.instagram.com/yourpage" target="_blank" rel="noopener" aria-label="Instagram">
                <i class="fa-brands fa-instagram fa-2x"></i>
              </a>

              <a href="https://www.tiktok.com/@yourpage" target="_blank" rel="noopener" aria-label="TikTok">
                <i class="fa-brands fa-tiktok fa-2x"></i>
              </a>

            </div>

          </div>

        </div>

        <!-- RIGHT COLUMN (FORM – UNCHANGED) -->
        <div class="col-md-6">
          <!-- your existing form panel stays exactly as-is -->

          <div class="glass-panel p-4">
            <h2 class="text-center mb-4">Get in Touch</h2>
            <div id="prefillBanner" class="alert alert-info py-2 mb-3" role="status" aria-live="polite"
              style="display:none">
              We’ve prefilled this form from the page you linked from. Please review, complete  and press Send.
            </div>
            <form id="contactForm" class="needs-validation" novalidate data-emailjs-public="7Z_MPVDF43IYCzaX6"
              data-emailjs-service="service_boc0sfb" data-emailjs-template="template_djivomr">
              <div class="mb-3">
                <label for="name" class="form-label" aria-placeholder="Enter your full name">Your Name</label>
                <input type="text" id="name" name="name" class="form-control" placeholder="Enter your full name"
                  required>
              </div>
              <div class="mb-3">
                <label for="email" class="form-label" aria-placeholder="Enter your preferred email address">Your
                  Email</label>
                <input type="email" id="email" name="email" class="form-control"
                  placeholder="Enter your preferred email address" required>
              </div>

              <div class="mb-3">
                <label for="subject" class="form-label" aria-placeholder="What is your enquiry about?">Subject</label>
                <input type="text" id="subject" name="subject" class="form-control"
                  placeholder="What is your enquiry about?" required>
              </div>
              <div class="mb-3">
                <label for="message" aria-placeholder="Write your message here..." form-label>Message</label>
                <textarea placeholder="Write your message here..." id="message" name="message" class="form-control"
                  rows="5" required></textarea>
              </div>
              <div class="text-center">
                <button type="submit" class="btn-glass" id="sendMessageBtn">Send Message</button>
              </div>
              <p id="formStatus" class="mt-3 visually-hidden" aria-live="polite"></p>
            </form>
          </div>
        </div>
      </div>
    </section>

  </main>

  <footer>
    <div id="site-footer"></div>
  </footer>
  <!-- SUCCESS MODAL -->
<div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content glass-panel soft-card border-0">
      <div class="modal-header border-0">
        <h5 class="modal-title" id="successModalLabel">Message sent</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="successModalBodyText">
        <!-- JS injects the success content here -->
        <p class="mb-0">Thanks — your message has been sent.</p>
      </div>
      <div class="modal-footer border-0">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- ERROR MODAL -->
<div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content glass-panel soft-card border-0">
      <div class="modal-header border-0">
        <h5 class="modal-title" id="errorModalLabel">Something went wrong</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p class="mb-0">
          Sorry — we couldn’t send your message just now. Please try again, or email us directly.
        </p>
      </div>
      <div class="modal-footer border-0">
        <a class="btn btn-outline-secondary" href="mailto:office@bb-northwest.org.uk">Email instead</a>
        <button type="button" class="btn btn-glass" data-bs-dismiss="modal">OK</button>
      </div>
    </div>
  </div>
</div>


<!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Google Translate -->
  <script>
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({ pageLanguage: 'en' }, 'google_translate_element_modal');
    }
  </script>
  <script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
  <!--contactpage-->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <!-- Theme & accessibility logic -->
  <script src="../theme.js"></script>
  <script defer src="../components/components.js"></script>

  <!-- Auto year -->
<script>
  const y = document.getElementById("year");
  if (y) y.textContent = new Date().getFullYear();
</script>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("contactForm");
    if (!form) return;

    const btn = document.getElementById("sendMessageBtn");
    const successModalEl = document.getElementById("successModal");
const successMsgEl =
  document.getElementById("successModalBodyText") ||
  document.getElementById("successModalBody") ||
  document.getElementById("successModalBodyTextAlt");

    
    const errorModalEl = document.getElementById("errorModal");
    
    const bannerEl = document.getElementById("prefillBanner");

    const publicKey = (form.dataset.emailjsPublic || "").trim();
    const serviceId  = (form.dataset.emailjsService || "").trim();
    const templateId = (form.dataset.emailjsTemplate || "").trim();

    if (!publicKey || !serviceId || !templateId) return;

    // Track origin/source for success message
    let fromParam = "";

    // Hide banner initially
    if (bannerEl) {
      bannerEl.classList.add("visually-hidden");
      bannerEl.style.display = "";
    }

    // Helper: show banner only when explicitly requested (prefill=1) OR sessionStorage prefill exists
    const maybeShowBanner = (params, hasPrefillPayload) => {
      if (!bannerEl) return;
      const prefillFlag = (params && params.get("prefill")) || ""; // "1" shows banner
      const shouldShow = !!hasPrefillPayload || prefillFlag === "1";

      if (shouldShow) {
        bannerEl.classList.remove("visually-hidden");
        bannerEl.style.display = "block";
      } else {
        bannerEl.classList.add("visually-hidden");
        bannerEl.style.display = "";
      }
    };

    // Prefill from sessionStorage (counts as real prefill)
    let hadSessionPrefill = false;
    try {
      const payload = JSON.parse(sessionStorage.getItem("bbnw_contact_prefill") || "null");
      if (payload) {
        if (form.name && !form.name.value) form.name.value = payload.name || "";
        if (form.email && !form.email.value) form.email.value = payload.email || "";
        if (form.subject && !form.subject.value) form.subject.value = payload.subject || "Enquiry";
        if (form.message && !form.message.value) form.message.value = payload.body || "";

        fromParam = payload.source || fromParam;
        hadSessionPrefill = true;

        sessionStorage.removeItem("bbnw_contact_prefill");
      }
    } catch {}

    // Prefill from URL (subject/from can be set WITHOUT showing banner)
    let urlParams = null;
    try {
      urlParams = new URLSearchParams(window.location.search);

      const subj = urlParams.get("subject");
      const from = urlParams.get("from");

      if (from) fromParam = from;
      if (subj && form.subject && !form.subject.value) form.subject.value = subj;

      // Banner shows ONLY if:
      // - sessionStorage prefill happened OR
      // - URL contains prefill=1
      maybeShowBanner(urlParams, hadSessionPrefill);

    } catch {
      maybeShowBanner(null, hadSessionPrefill);
    }

    // Remove query params to prevent banner on reload (but keep fromParam saved above)
    try {
      const url = new URL(window.location.href);
      if (url.search) {
        url.search = "";
        window.history.replaceState({}, document.title, url.toString());
      }
    } catch (e) {
      console.warn("Failed to clean URL", e);
    }

    // Wait for EmailJS
    const waitForEmailJS = () =>
      new Promise((resolve, reject) => {
        const interval = setInterval(() => {
          if (window.emailjs && typeof window.emailjs.sendForm === "function") {
            clearInterval(interval);
            resolve();
          }
        }, 50);

        setTimeout(() => {
          clearInterval(interval);
          reject("EmailJS failed to load");
        }, 5000);
      });

    waitForEmailJS()
      .then(() => {
        try {
          window.emailjs.init(publicKey);
        } catch (e) {
          console.error(e);
        }

        const successModalInstance = successModalEl ? new bootstrap.Modal(successModalEl) : null;
        const errorModalInstance = errorModalEl ? new bootstrap.Modal(errorModalEl) : null;

        // Unlock scroll when modal closes
        if (successModalEl) {
          successModalEl.addEventListener("hidden.bs.modal", () => {
            document.body.classList.remove("modal-open");
          });
        }

        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          e.stopPropagation();
          form.classList.add("was-validated");

          // Required field check (works with prefilled values)
          const requiredFields = [form.name, form.email, form.subject, form.message];
          const emptyFields = requiredFields.filter((f) => !f || !f.value.trim());
          if (emptyFields.length > 0) {
            emptyFields[0].focus();
            alert("Please fill in all required fields before sending.");
            return;
          }

          if (btn) {
            btn.disabled = true;
            btn.setAttribute("aria-busy", "true");
            btn.textContent = "Sending…";
          }

          try {
            await window.emailjs.sendForm(serviceId, templateId, form);

            // Populate success modal
            if (successMsgEl) {
              successMsgEl.innerHTML = `
                <div class="text-center">
                  <div class="display-4 text-success mb-2">✅</div>
                  <h5 class="fw-bold mb-2">Message sent</h5>
                  <p class="mb-0">
                    Thanks — we’ve received your enquiry${
                      fromParam ? ` from <strong>${fromParam}</strong>` : ""
                    }.
                  </p>
                </div>
              `;
            }

            if (successModalInstance) successModalInstance.show();

            form.reset();
            form.classList.remove("was-validated");

            // Hide prefill banner after successful send
            if (bannerEl) {
              bannerEl.classList.add("visually-hidden");
              bannerEl.style.display = "";
            }
          } catch (err) {
            console.error("EmailJS send failed:", err);
            if (errorModalInstance) errorModalInstance.show();
          } finally {
            if (btn) {
              btn.disabled = false;
              btn.setAttribute("aria-busy", "false");
              btn.textContent = "Send Message";
            }
          }
        });
      })
      .catch((err) => console.error("EmailJS load error:", err));
  });
</script>
